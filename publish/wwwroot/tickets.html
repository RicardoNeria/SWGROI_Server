<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gestión de Tickets - SWGROI</title>
    <link rel="stylesheet" href="Styles/componentes/componentes.css">
    <link rel="stylesheet" href="Styles/tickets.css">
    <script src="Scripts/icon-loader.js" defer></script>
    <script src="Scripts/ui-utils.js" defer></script>
    <script src="Scripts/seguridad.js" defer></script>
    <script src="Scripts/ui.js" defer></script>
</head>
<body class="ui-layout ui-layout--no-topbar">

    <!-- SIDEBAR UNIFICADO -->
    <aside class="ui-sidebar" role="navigation" aria-label="Navegación principal">
        <div class="ui-sidebar__header">
            <h2 class="ui-sidebar__title">SWGROI</h2>
            <div class="ui-sidebar__logo">
                <img src="Imagenes/CENTRALDEALARMAS1.png" alt="Logo Central de Alarmas" class="ui-sidebar__logo-img">
            </div>
        </div>
        <nav class="ui-sidebar__nav">
            <ul class="ui-sidebar__menu">
                <li class="ui-sidebar__item">
                    <a href="menu.html" class="ui-sidebar__link"><span class="ui-button__icon" data-icon="home" aria-hidden="true"></span> Menú principal</a>
                </li>
                <li class="ui-sidebar__item">
                    <a href="#" class="ui-sidebar__link ui-sidebar__link--active" aria-current="page">
                        <span class="ui-button__icon" data-icon="ticket" aria-hidden="true"></span> Gestión de Tickets
                    </a>
                </li>
                <li class="ui-sidebar__item">
                    <a href="logout" class="ui-sidebar__link ui-sidebar__link--logout"><span class="ui-button__icon" data-icon="logout" aria-hidden="true"></span> Cerrar sesión</a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="ui-layout__main">
    <div class="ui-card ui-card--module documentos-container" role="region" aria-label="Módulo de Gestión de Tickets">
            
            <!-- BREADCRUMBS -->
            <nav class="ui-breadcrumbs" aria-label="Rastro de navegación">
                <ol class="ui-breadcrumbs__list">
                    <li class="ui-breadcrumbs__item">
                        <a href="menu.html" class="ui-breadcrumbs__link">Inicio</a>
                    </li>
                    <li class="ui-breadcrumbs__item ui-breadcrumbs__item--active" aria-current="page">
                        <span class="ui-breadcrumbs__separator">/</span>
                        <span class="ui-breadcrumbs__current">Gestión de Tickets</span>
                    </li>
                </ol>
            </nav>

            <!-- TÍTULO PRINCIPAL -->
            <h2 class="ui-card__title"><span class="ui-button__icon" data-icon="ticket" aria-hidden="true"></span> Gestión de Tickets de Soporte</h2>

            <!-- MENSAJE DE ESTADO GLOBAL -->
            <div class="ui-message-container">
                <div id="leyenda" class="ui-message" style="display:none" aria-live="polite">
                    <span class="ui-message__icon" aria-hidden="true"></span>
                    <span class="ui-message__text"></span>
                </div>
            </div>

            <!-- BUSCADOR DE TICKETS -->
            <section class="tickets-buscador" aria-label="Búsqueda de tickets">
                <div class="ui-form-group">
                    <label for="buscadorFolio" class="ui-form__label">Buscar ticket por folio:</label>
                    <div class="ui-form__field tickets-buscador__field">
                        <input type="text" id="buscadorFolio" class="ui-form__input" 
                               placeholder="Ingrese el folio del ticket..." aria-label="Folio del ticket">
                        <button type="button" id="btnBuscar" class="ui-button ui-button--primary">
                            <span class="ui-button__icon" data-icon="search"></span>Buscar
                        </button>
                    </div>
                </div>
            </section>

            <!-- FORMULARIO DE TICKETS -->
            <section class="tickets-formulario" aria-label="Formulario de tickets">
                <form id="formularioTicket" class="ui-form">
                    <div class="tickets-formulario__grid">
                        <!-- Columna izquierda -->
                        <div class="tickets-formulario__columna">
                            <div class="ui-form-group">
                                <label for="folio" class="ui-form__label">Folio del Ticket:</label>
                                <div class="ui-form__field">
                                    <input type="text" id="folio" name="folio" class="ui-form__input" 
                                           required pattern="^[A-Z0-9\-]{6,20}$" minlength="6" maxlength="20"
                                           placeholder="Ej: TKT-2025-001" 
                                           aria-describedby="folioFeedback">
                                </div>
                                <div id="folioFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>

                            <div class="ui-form-group">
                                <label for="descripcion" class="ui-form__label">Descripción del problema:</label>
                                <div class="ui-form__field">
                                    <textarea id="descripcion" name="descripcion" class="ui-form__input" 
                                              required minlength="10" maxlength="2000" rows="4"
                                              placeholder="Describe detalladamente el problema o solicitud..."
                                              aria-describedby="descripcionFeedback"></textarea>
                                </div>
                                <div id="descripcionFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>

                            <div class="ui-form-group">
                                <label for="estado" class="ui-form__label">Estado inicial:</label>
                                <div class="ui-form__field">
                                    <select id="estado" name="estado" class="ui-form__input" required>
                                        <option value="">-- Seleccionar estado --</option>
                                        <option value="Almacén">Almacén</option>
                                        <option value="Capturado">Capturado</option>
                                        <option value="Programado/Asignado">Programado/Asignado</option>
                                        <option value="Abierto">Abierto</option>
                                        <option value="En Proceso">En Proceso</option>
                                        <option value="Cerrado">Cerrado</option>
                                    </select>
                                </div>
                                <div id="estadoFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>
                        </div>

                        <!-- Columna derecha -->
                        <div class="tickets-formulario__columna">
                            <div class="ui-form-group">
                                <label for="responsable" class="ui-form__label">Responsable:</label>
                                <div class="ui-form__field">
                                    <input type="text" id="responsable" name="responsable" class="ui-form__input" 
                                           readonly aria-describedby="responsableFeedback">
                                </div>
                                <div id="responsableFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>

                            <div class="ui-form-group">
                                <label for="estadoSeguimiento" class="ui-form__label">Estado actual del seguimiento:</label>
                                <div class="ui-form__field">
                                    <input type="text" id="estadoSeguimiento" class="ui-form__input ui-form__display" 
                                           readonly aria-describedby="estadoSeguimientoFeedback">
                                </div>
                                <div id="estadoSeguimientoFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>

                            <div class="ui-form-group">
                                <label for="comentarioTecnico" class="ui-form__label">Respuesta Técnica Mesa de Control:</label>
                                <div class="ui-form__field">
                                    <textarea id="comentarioTecnico" class="ui-form__input ui-form__display" 
                                              readonly rows="4" aria-describedby="comentarioTecnicoFeedback">(No hay comentarios técnicos aún)</textarea>
                                </div>
                                <div id="comentarioTecnicoFeedback" class="ui-form__feedback" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ACCIONES DEL FORMULARIO -->
                    <div class="ui-form__actions tickets-formulario__acciones">
                        <button type="submit" class="ui-button ui-button--primary">
                            <span class="ui-button__icon" data-icon="plus"></span>Registrar Ticket
                        </button>
                        <button type="button" id="actualizarBtn" class="ui-button ui-button--secondary">
                            <span class="ui-button__icon" data-icon="refresh"></span>Actualizar Ticket
                        </button>
                        <button type="button" id="limpiarBtn" class="ui-button ui-button--ghost">
                            <span class="ui-button__icon" data-icon="clear"></span>Limpiar Campos
                        </button>
                    </div>
                </form>
            </section>

            <!-- KPIs/MÉTRICAS DE TICKETS -->
            <section class="ui-metrics tickets-metricas" aria-label="Indicadores de tickets" id="kpisTickets" style="display:none">
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">Abiertos</div>
                    <div id="kpiAbiertos" class="ui-metrics__value">0</div>
                </div>
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">En Proceso</div>
                    <div id="kpiProceso" class="ui-metrics__value">0</div>
                </div>
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">Cerrados</div>
                    <div id="kpiCerrados" class="ui-metrics__value">0</div>
                </div>
            </section>

            <!-- FILTROS PARA LA TABLA -->
            <div class="ui-filters">
                <form class="ui-filters__form" role="search" aria-label="Filtros para tabla de tickets">
                    <input type="text" id="filtroTicket" class="ui-filters__input" 
                           placeholder="Filtrar por folio o responsable..." aria-label="Filtrar tickets">
                    
                    <select id="filtroEstadoTicket" class="ui-filters__select" aria-label="Filtrar por estado">
                        <option value="">-- Todos los estados --</option>
                        <option value="Almacén">Almacén</option>
                        <option value="Capturado">Capturado</option>
                        <option value="Programado/Asignado">Programado/Asignado</option>
                        <option value="Abierto">Abierto</option>
                        <option value="En Proceso">En Proceso</option>
                        <option value="Cerrado">Cerrado</option>
                    </select>

                    <button type="button" id="btnBuscarTicket" class="ui-button ui-button--primary" 
                            aria-controls="tablaTickets">
                        <span class="ui-button__icon" data-icon="search"></span>Buscar
                    </button>
                    <button type="button" id="btnLimpiarTabla" class="ui-button ui-button--secondary">
                        <span class="ui-button__icon" data-icon="clear"></span>Limpiar
                    </button>
                </form>

                <div class="ui-actions">
                    <button class="ui-button ui-button--ghost" id="btnExportCsvTickets" aria-controls="tablaTickets">
                        <span class="ui-button__icon" data-icon="export"></span>Exportar CSV
                    </button>
                    <button class="ui-button ui-button--secondary" id="btnImprimirTickets" aria-controls="tablaTickets">
                        <span class="ui-button__icon" data-icon="print"></span>Imprimir/PDF
                    </button>
                </div>
            </div>

            <!-- TABLA DE TICKETS -->
            <section class="ui-card ui-card--report" aria-label="Listado de tickets">
                <div class="ui-tabla-wrap ui-desplazable">
                    <table class="ui-tabla" id="tablaTickets" role="table" aria-describedby="leyenda">
                        <thead class="ui-tabla__head">
                            <tr role="row">
                                <th scope="col" class="ui-tabla__col">Folio</th>
                                <th scope="col" class="ui-tabla__col">Descripción</th>
                                <th scope="col" class="ui-tabla__col">Estado Ticket</th>
                                <th scope="col" class="ui-tabla__col">Responsable</th>
                                <th scope="col" class="ui-tabla__col">Comentario</th>
                                <th scope="col" class="ui-tabla__col">Última actualización</th>
                                <th scope="col" class="ui-tabla__col ui-tabla__col--acciones">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="ui-tabla__body">
                            <!-- Contenido dinámico generado por JS -->
                            <tr class="ui-tabla__row">
                                <td class="ui-tabla__cell" colspan="7">
                                    <div class="tickets-mensaje-vacio">
                                        Cargando tickets...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- PAGINACIÓN -->
                <div class="ui-paginacion" role="navigation" aria-label="Paginación de tickets">
                    <span id="lblPaginacionTickets" class="ui-paginacion__info">Cargando...</span>
                    <div class="ui-paginacion__controles">
                        <button id="btnPrevTickets" class="ui-button ui-button--ghost ui-paginacion__btn" 
                                type="button" aria-label="Página anterior" disabled>
                            <span class="ui-button__icon" data-icon="prev"></span>Anterior
                        </button>
                        <button id="btnNextTickets" class="ui-button ui-button--ghost ui-paginacion__btn" 
                                type="button" aria-label="Página siguiente" disabled>
                            Siguiente<span class="ui-button__icon" data-icon="next"></span>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- MODAL DE CONFIRMACIÓN -->
    <div class="ui-modal-overlay" id="modalConfirmacion" role="dialog" aria-modal="true" 
         aria-labelledby="modalConfirmacionTitulo" style="display:none">
        <div class="ui-modal" role="document">
            <div class="ui-modal__header">
                <h3 id="modalConfirmacionTitulo" class="ui-modal__title">Confirmar acción</h3>
                <button class="ui-button ui-button--ghost ui-modal__close" 
                        aria-label="Cerrar modal" onclick="cerrarModalConfirmacion()">
                    <span class="ui-button__icon" data-icon="x"></span>
                </button>
            </div>

            <div class="ui-modal__body">
                <p id="modalConfirmacionMensaje">¿Está seguro de que desea continuar?</p>
            </div>

            <div class="ui-modal__actions">
                <button class="ui-button ui-button--secondary" onclick="cerrarModalConfirmacion()">
                    <span class="ui-button__icon" data-icon="cancel"></span>Cancelar
                </button>
                <button id="btnConfirmarAccion" class="ui-button ui-button--primary">
                    <span class="ui-button__icon" data-icon="check"></span>Confirmar
                </button>
            </div>
        </div>
    </main>

    <script src="Scripts/tickets.js"></script>
</body>
</html>
