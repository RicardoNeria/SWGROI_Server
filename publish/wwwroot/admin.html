<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Administración de Usuarios - SWGROI</title>
    <link rel="stylesheet" href="Styles/componentes/componentes.css">
    <link rel="stylesheet" href="Styles/admin.css">
    <script src="Scripts/ui-utils.js" defer></script>
    <script src="Scripts/seguridad.js" defer></script>
    <script src="Scripts/ui.js" defer></script>
    <script src="Scripts/icon-loader.js" defer></script>
</head>
<body class="ui-layout ui-layout--no-topbar">

    <!-- SIDEBAR UNIFICADO -->
    <aside class="ui-sidebar" role="navigation" aria-label="Navegación principal">
        <div class="ui-sidebar__header">
            <h2 class="ui-sidebar__title">SWGROI</h2>
            <div class="ui-sidebar__logo">
                <img src="Imagenes/CENTRALDEALARMAS1.png" alt="Logo Central de Alarmas" class="ui-sidebar__logo-img">
            </div>
        </div>
        <nav class="ui-sidebar__nav">
            <ul class="ui-sidebar__menu">
                <li class="ui-sidebar__item">
                    <a href="menu.html" class="ui-sidebar__link"><span class="ui-button__icon" data-icon="home" aria-hidden="true"></span> Menú principal</a>
                </li>
                <li class="ui-sidebar__item">
                    <a href="admin.html" class="ui-sidebar__link ui-sidebar__link--active" aria-current="page">
                        <span class="ui-button__icon" data-icon="users" aria-hidden="true"></span> Administración de Usuarios
                    </a>
                </li>
                <li class="ui-sidebar__item">
                    <a href="logout" class="ui-sidebar__link ui-sidebar__link--logout"><span class="ui-button__icon" data-icon="logout" aria-hidden="true"></span> Cerrar sesión</a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="ui-layout__main">
        <div class="ui-card ui-card--module documentos-container">
            
            <!-- BREADCRUMBS -->
            <nav class="ui-breadcrumbs" aria-label="Rastro de navegación">
                <ol class="ui-breadcrumbs__list">
                    <li class="ui-breadcrumbs__item">
                        <a href="menu.html" class="ui-breadcrumbs__link">Inicio</a>
                    </li>
                    <li class="ui-breadcrumbs__item ui-breadcrumbs__item--active" aria-current="page">
                        <span class="ui-breadcrumbs__separator">/</span>
                        <span class="ui-breadcrumbs__current">Administración de Usuarios</span>
                    </li>
                </ol>
            </nav>

            <!-- TÍTULO PRINCIPAL -->
            <h2 class="ui-card__title"><span class="ui-button__icon" data-icon="users" aria-hidden="true"></span> Administración de Usuarios</h2>

            <!-- KPIs/MÉTRICAS DEL MÓDULO -->
            <section class="ui-metrics" aria-label="Indicadores principales">
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">Total Usuarios</div>
                    <div id="kpiTotal" class="ui-metrics__value">0</div>
                </div>
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">Administradores</div>
                    <div id="kpiAdmins" class="ui-metrics__value">0</div>
                </div>
                <div class="ui-metrics__item">
                    <div class="ui-metrics__title">Usuarios Activos</div>
                    <div id="kpiActivos" class="ui-metrics__value">0</div>
                </div>
            </section>

            <!-- FILTROS Y ACCIONES PRINCIPALES -->
            <div class="ui-filters">
                <form id="formFiltro" class="ui-filters__form" role="search" aria-label="Filtros de búsqueda">
                    <input type="text" id="buscador" class="ui-filters__input" 
                           placeholder="Buscar por nombre o usuario..." aria-label="Buscar usuarios">
                    
                    <select id="filtroRol" class="ui-filters__select" aria-label="Filtrar por rol">
                        <option value="">-- Todos los roles --</option>
                        <option value="Administrador">Administrador</option>
                        <option value="Supervisor">Supervisor</option>
                        <option value="Operador">Operador</option>
                        <option value="Técnico">Técnico</option>
                    </select>

                    <button type="button" id="btnBuscar" class="ui-button ui-button--primary" 
                            aria-controls="tablaUsuarios">
                        <span class="ui-button__icon" data-icon="search" aria-hidden="true"></span>Buscar
                    </button>
                    <button type="button" id="btnLimpiar" class="ui-button ui-button--secondary">
                        <span class="ui-button__icon" data-icon="clear" aria-hidden="true"></span>Limpiar
                    </button>
                </form>

                <div class="ui-actions">
                    <button class="ui-button ui-button--primary" id="btnNuevo" 
                            aria-controls="modalFormulario">
                        <span class="ui-button__icon" data-icon="plus" aria-hidden="true"></span>Nuevo Usuario
                    </button>
                    <button class="ui-button ui-button--ghost" id="btnExportar" aria-controls="tablaUsuarios">
                        <span class="ui-button__icon" data-icon="export" aria-hidden="true"></span>Exportar
                    </button>
                    <button class="ui-button ui-button--secondary" id="btnRefrescar" aria-controls="tablaUsuarios">
                        <span class="ui-button__icon" data-icon="refresh" aria-hidden="true"></span>Actualizar
                    </button>
                </div>
            </div>

            <!-- MENSAJE DE ESTADO GLOBAL -->
            <div class="ui-message-container">
                <div id="leyenda" class="ui-message" style="display:none" aria-live="polite">
                    <span class="ui-message__icon" aria-hidden="true"></span>
                    <span class="ui-message__text"></span>
                </div>
            </div>

            <!-- TABLA DE USUARIOS -->
            <section class="ui-card ui-card--report" aria-label="Listado de usuarios">
                <div class="ui-tabla-wrap ui-desplazable">
                    <table class="ui-tabla" role="table">
                        <thead class="ui-tabla__head">
                            <tr role="row">
                                <th scope="col" class="ui-tabla__col">Acciones</th>
                                <th scope="col" class="ui-tabla__col">ID</th>
                                <th scope="col" class="ui-tabla__col">Nombre Completo</th>
                                <th scope="col" class="ui-tabla__col">Usuario</th>
                                <th scope="col" class="ui-tabla__col">Rol</th>
                            </tr>
                        </thead>
                        <tbody id="tablaUsuarios" class="ui-tabla__body">
                            <!-- Contenido dinámico generado por admin.js -->
                        </tbody>
                    </table>
                </div>

                <!-- PAGINACIÓN UNIFICADA -->
                <div class="ui-paginacion" role="navigation" aria-label="Paginación de resultados">
                    <span id="paginacionInfo" class="ui-paginacion__info">Mostrando 0-0 de 0 usuarios</span>
                    <div id="paginacion" class="ui-paginacion__controles">
                        <!-- Controles de paginación generados dinámicamente -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- MODAL FORMULARIO USUARIO -->
    <div class="ui-modal-overlay" id="modalFormulario" role="dialog" aria-modal="true" 
         aria-labelledby="modalTitulo" style="display:none">
        <div class="ui-modal" role="document">
            <div class="ui-modal__header">
                <h3 id="modalTitulo" class="ui-modal__title">Agregar Usuario</h3>
                <button class="ui-button ui-button--ghost ui-modal__close" 
                        aria-label="Cerrar modal" id="btnCerrarFormulario">
                    <span class="ui-button__icon" data-icon="close" aria-hidden="true"></span>
                </button>
            </div>

            <div class="ui-modal__body">
                <form id="formCrearUsuario" class="ui-form" role="form" autocomplete="off">
                    <input type="hidden" id="usuarioId" />
                    
                    <div class="ui-form-group">
                        <label for="nombre" class="ui-form__label">Nombre Completo:</label>
                        <div class="ui-form__field">
                            <input id="nombre" name="NombreCompleto" type="text" class="ui-form__input" 
                                   placeholder="Nombre completo del usuario" required maxlength="150"
                                   aria-describedby="nombreFeedback">
                        </div>
                        <div id="nombreFeedback" class="ui-form__feedback" aria-live="polite"></div>
                    </div>

                    <div class="ui-form-group">
                        <label for="usuario" class="ui-form__label">Usuario:</label>
                        <div class="ui-form__field">
                            <input id="usuario" name="Usuario" type="text" class="ui-form__input" 
                                   placeholder="Nombre de usuario (login)" required maxlength="100"
                                   aria-describedby="usuarioFeedback">
                        </div>
                        <div id="usuarioFeedback" class="ui-form__feedback" aria-live="polite"></div>
                    </div>

                    <div class="ui-form-group">
                        <label for="contrasena" class="ui-form__label">Contraseña:</label>
                        <div class="ui-form__field">
                            <input id="contrasena" name="Contrasena" type="password" class="ui-form__input" 
                                   placeholder="Contraseña (mínimo 6 caracteres)" maxlength="100"
                                   aria-describedby="contrasenaFeedback">
                        </div>
                        <div id="contrasenaFeedback" class="ui-form__feedback" aria-live="polite"></div>
                        <small class="ui-form__help">Deje en blanco para mantener la contraseña actual (solo en edición)</small>
                    </div>

                    <div class="ui-form-group">
                        <label for="rol" class="ui-form__label">Rol:</label>
                        <div class="ui-form__field">
                            <select id="rol" name="Rol" class="ui-form__input" required>
                                <option value="">-- Seleccionar rol --</option>
                                <option value="Administrador">Administrador</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Operador">Operador</option>
                                <option value="Técnico">Técnico</option>
                            </select>
                        </div>
                        <div id="rolFeedback" class="ui-form__feedback" aria-live="polite"></div>
                    </div>
                </form>
            </div>

            <div class="ui-modal__actions">
                <button class="ui-button ui-button--secondary" id="btnCancelar">
                    <span class="ui-button__icon" data-icon="cancel" aria-hidden="true"></span>Cancelar
                </button>
                <button class="ui-button ui-button--primary" id="guardarBtn">
                    <span class="ui-button__icon" data-icon="save" aria-hidden="true"></span>Guardar
                </button>
                <button class="ui-button ui-button--primary" id="actualizarBtn" style="display:none">
                    <span class="ui-button__icon" data-icon="edit" aria-hidden="true"></span>Actualizar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL VER USUARIO -->
    <div class="ui-modal-overlay" id="modalUsuario" role="dialog" aria-modal="true" 
         aria-labelledby="tituloUsuario" style="display:none">
        <div class="ui-modal" role="document">
            <div class="ui-modal__header">
                <h3 id="tituloUsuario" class="ui-modal__title">Detalle de Usuario</h3>
                <button class="ui-button ui-button--ghost ui-modal__close" 
                        aria-label="Cerrar modal" id="btnCerrarUsuario">
                    <span class="ui-button__icon" data-icon="close" aria-hidden="true"></span>
                </button>
            </div>

            <div class="ui-modal__body">
                <div class="ui-form">
                    <div class="ui-form-group">
                        <label class="ui-form__label">ID:</label>
                        <div id="verId" class="ui-form__value"></div>
                    </div>
                    <div class="ui-form-group">
                        <label class="ui-form__label">Nombre Completo:</label>
                        <div id="verNombre" class="ui-form__value"></div>
                    </div>
                    <div class="ui-form-group">
                        <label class="ui-form__label">Usuario:</label>
                        <div id="verUsuario" class="ui-form__value"></div>
                    </div>
                    <div class="ui-form-group">
                        <label class="ui-form__label">Rol:</label>
                        <div id="verRol" class="ui-form__value"></div>
                    </div>
                </div>
            </div>

            <div class="ui-modal__actions">
                <button class="ui-button ui-button--secondary" id="btnCerrarVista">
                    <span class="ui-button__icon" data-icon="close" aria-hidden="true"></span>Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIRMACIÓN ELIMINACIÓN -->
    <div class="ui-modal-overlay" id="modalEliminar" role="dialog" aria-modal="true" 
         aria-labelledby="eliminarTitulo" style="display:none">
        <div class="ui-modal" role="document">
            <div class="ui-modal__header">
                <h3 id="eliminarTitulo" class="ui-modal__title">Confirmar eliminación</h3>
                <button class="ui-button ui-button--ghost ui-modal__close" 
                        aria-label="Cerrar modal" id="btnCerrarEliminar">
                    <span class="ui-button__icon" data-icon="x"></span>
                </button>
            </div>

            <div class="ui-modal__body">
                <p>¿Está seguro de que desea eliminar este usuario? Esta acción no se puede deshacer.</p>
                <div id="usuarioEliminar" class="ui-form__value"></div>
            </div>

            <div class="ui-modal__actions">
                <button class="ui-button ui-button--secondary" id="btnCancelarEliminar">
                    <span class="ui-button__icon" data-icon="cancel" aria-hidden="true"></span>Cancelar
                </button>
                <button class="ui-button ui-button--danger" id="btnConfirmarEliminar">
                    <span class="ui-button__icon" data-icon="delete" aria-hidden="true"></span>Eliminar
                </button>
            </div>
        </div>
    </div>

    <script src="Scripts/admin.js"></script>
</body>
</html>
